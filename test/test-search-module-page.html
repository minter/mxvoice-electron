<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Module Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .info {
            color: #17a2b8;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .mock-ui {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .mock-ui input, .mock-ui select {
            margin: 5px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Search Module Test</h1>
        <p>This page tests the search module functionality in a browser environment.</p>

        <div class="test-section">
            <h2>Mock UI Elements</h2>
            <div class="mock-ui">
                <input type="text" id="omni_search" placeholder="Search term..." value="test">
                <select id="category_select">
                    <option value="*">All Categories</option>
                    <option value="rock">Rock</option>
                    <option value="pop">Pop</option>
                </select>
                <div id="advanced-search" style="display: none;">
                    <input type="text" id="title-search" placeholder="Title...">
                    <input type="text" id="artist-search" placeholder="Artist...">
                    <input type="text" id="info-search" placeholder="Info...">
                    <input type="number" id="date-search" placeholder="Days since...">
                </div>
                <div id="search_results">
                    <thead style="display: none;">
                        <tr><th>Category</th><th>Info</th><th>Title</th><th>Artist</th><th>Time</th></tr>
                    </thead>
                    <tbody></tbody>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Test Controls</h2>
            <button onclick="testModuleLoading()">Test Module Loading</button>
            <button onclick="testFunctions()">Test Functions</button>
            <button onclick="testSearchQuery()">Test Search Query</button>
            <button onclick="testLiveSearch()">Test Live Search</button>
            <button onclick="testAdvancedSearch()">Test Advanced Search</button>
            <button onclick="runAllTests()">Run All Tests</button>
        </div>

        <div class="test-section">
            <h2>Test Results</h2>
            <div id="test-results">
                <p class="info">Click a test button to see results...</p>
            </div>
        </div>

        <div class="test-section">
            <h2>Console Output</h2>
            <pre id="console-output">Console output will appear here...</pre>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Mock global variables and functions
        window.fontSize = 11;
        window.categories = {
            'rock': 'Rock',
            'pop': 'Pop',
            'jazz': 'Jazz'
        };
        window.db = {
            prepare: (sql) => ({
                all: (params) => [
                    {
                        id: 1,
                        category: 'rock',
                        info: 'Test info',
                        title: 'Test song',
                        artist: 'Test artist',
                        time: '3:45'
                    }
                ]
            })
        };
        window.searchTimeout = null;
        window.clearTimeout = () => {};
        window.scale_scrollable = () => {};
        window.animateCSS = (element, animation) => Promise.resolve();
        window.electronAPI = {
            database: {
                query: (sql, params) => Promise.resolve({ 
                    success: true, 
                    data: [
                        {
                            id: 1,
                            category: 'rock',
                            info: 'Test info',
                            title: 'Test song',
                            artist: 'Test artist',
                            time: '3:45'
                        }
                    ] 
                })
            }
        };

        // Capture console output
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };

        function captureConsole() {
            const output = document.getElementById('console-output');
            console.log = function(...args) {
                originalConsole.log.apply(console, args);
                output.textContent += args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
            };
            console.error = function(...args) {
                originalConsole.error.apply(console, args);
                output.textContent += 'ERROR: ' + args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
            };
            console.warn = function(...args) {
                originalConsole.warn.apply(console, args);
                output.textContent += 'WARN: ' + args.join(' ') + '\n';
                output.scrollTop = output.scrollHeight;
            };
        }

        function updateResults(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            document.getElementById('console-output').textContent = '';
        }

        function testModuleLoading() {
            clearResults();
            updateResults('üß™ Testing module loading...', 'info');
            
            try {
                // Note: In a real browser environment, we'd need to load the module differently
                // This is a simplified test
                updateResults('‚úÖ Module loading test completed (simulated)', 'success');
            } catch (error) {
                updateResults('‚ùå Module loading failed: ' + error.message, 'error');
            }
        }

        function testFunctions() {
            clearResults();
            updateResults('üß™ Testing function availability...', 'info');
            
            // Test jQuery functionality
            if (typeof $ !== 'undefined') {
                updateResults('‚úÖ jQuery is available', 'success');
            } else {
                updateResults('‚ùå jQuery is not available', 'error');
            }

            // Test global variables
            if (typeof window.fontSize !== 'undefined') {
                updateResults('‚úÖ fontSize is available', 'success');
            } else {
                updateResults('‚ùå fontSize is not available', 'error');
            }

            if (typeof window.categories !== 'undefined') {
                updateResults('‚úÖ categories is available', 'success');
            } else {
                updateResults('‚ùå categories is not available', 'error');
            }

            if (typeof window.db !== 'undefined') {
                updateResults('‚úÖ db is available', 'success');
            } else {
                updateResults('‚ùå db is not available', 'error');
            }
        }

        function testSearchQuery() {
            clearResults();
            updateResults('üß™ Testing search query building...', 'info');
            
            try {
                // Simulate query building
                const searchTerm = $('#omni_search').val();
                const category = $('#category_select').val();
                
                let queryString = "SELECT * from mrvoice";
                const queryParams = [];
                const querySegments = [];

                if (category !== "*") {
                    querySegments.push("category = ?");
                    queryParams.push(category);
                }

                if (searchTerm && searchTerm.length > 0) {
                    const searchTermParam = "%" + searchTerm + "%";
                    querySegments.push("(info LIKE ? OR title LIKE ? OR artist like ?)");
                    queryParams.push(searchTermParam, searchTermParam, searchTermParam);
                }

                if (querySegments.length > 0) {
                    queryString += " WHERE " + querySegments.join(" AND ");
                }

                queryString += " ORDER BY category,info,title,artist";

                updateResults('‚úÖ Query building successful', 'success');
                updateResults('Query: ' + queryString, 'info');
                updateResults('Params: ' + JSON.stringify(queryParams), 'info');
            } catch (error) {
                updateResults('‚ùå Query building failed: ' + error.message, 'error');
            }
        }

        function testLiveSearch() {
            clearResults();
            updateResults('üß™ Testing live search...', 'info');
            
            try {
                const searchTerm = $('#omni_search').val();
                updateResults('‚úÖ Live search test completed with term: ' + searchTerm, 'success');
            } catch (error) {
                updateResults('‚ùå Live search test failed: ' + error.message, 'error');
            }
        }

        function testAdvancedSearch() {
            clearResults();
            updateResults('üß™ Testing advanced search toggle...', 'info');
            
            try {
                const advancedSearch = $('#advanced-search');
                const isVisible = advancedSearch.is(':visible');
                updateResults('‚úÖ Advanced search toggle test completed', 'success');
                updateResults('Advanced search is currently: ' + (isVisible ? 'visible' : 'hidden'), 'info');
            } catch (error) {
                updateResults('‚ùå Advanced search test failed: ' + error.message, 'error');
            }
        }

        function runAllTests() {
            clearResults();
            updateResults('üöÄ Running all tests...', 'info');
            
            setTimeout(() => testModuleLoading(), 100);
            setTimeout(() => testFunctions(), 200);
            setTimeout(() => testSearchQuery(), 300);
            setTimeout(() => testLiveSearch(), 400);
            setTimeout(() => testAdvancedSearch(), 500);
        }

        // Initialize
        captureConsole();
        updateResults('‚úÖ Test page loaded successfully', 'success');
        updateResults('Click the test buttons above to run tests', 'info');
    </script>
</body>
</html> 