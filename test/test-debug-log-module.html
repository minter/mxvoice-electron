<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DebugLog Module Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-info { background-color: #17a2b8; color: white; }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .log-error { color: #dc3545; }
        .log-warn { color: #ffc107; }
        .log-info { color: #17a2b8; }
        .log-debug { color: #6c757d; }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .test-column {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <h1>DebugLog Module Test</h1>
    
    <div class="test-section info">
        <h3>Test Overview</h3>
        <p>This test verifies the DebugLog module functionality:</p>
        <ul>
            <li>‚úÖ Log levels (ERROR, WARN, INFO, DEBUG)</li>
            <li>‚úÖ Context support and formatting</li>
            <li>‚úÖ Debug preference integration</li>
            <li>‚úÖ Performance optimization (caching)</li>
            <li>‚úÖ Backward compatibility</li>
        </ul>
    </div>

    <div class="test-grid">
        <div class="test-column">
            <div class="test-section">
                <h3>1. Basic Logging Tests</h3>
                <button class="btn-primary" onclick="testBasicLogging()">Test Basic Logging</button>
                <button class="btn-success" onclick="testLogLevels()">Test Log Levels</button>
                <button class="btn-warning" onclick="testContextLogging()">Test Context Logging</button>
                <div id="basic-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>2. Debug Preference Tests</h3>
                <button class="btn-primary" onclick="testDebugPreference()">Test Debug Preference</button>
                <button class="btn-success" onclick="testDebugToggle()">Toggle Debug (On/Off)</button>
                <button class="btn-info" onclick="testDebugCaching()">Test Debug Caching</button>
                <div id="debug-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>3. Context Formatting Tests</h3>
                <button class="btn-primary" onclick="testContextFormatting()">Test Context Formatting</button>
                <button class="btn-success" onclick="testErrorContext()">Test Error Context</button>
                <button class="btn-warning" onclick="testComplexContext()">Test Complex Context</button>
                <div id="context-result" class="result"></div>
            </div>
        </div>

        <div class="test-column">
            <div class="test-section">
                <h3>4. Performance Tests</h3>
                <button class="btn-primary" onclick="testPerformance()">Test Performance</button>
                <button class="btn-success" onclick="testCaching()">Test Caching</button>
                <button class="btn-info" onclick="testConditionalLogging()">Test Conditional Logging</button>
                <div id="performance-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>5. Module Integration Tests</h3>
                <button class="btn-primary" onclick="testModuleLoading()">Test Module Loading</button>
                <button class="btn-success" onclick="testFunctionExports()">Test Function Exports</button>
                <button class="btn-warning" onclick="testReinitialization()">Test Reinitialization</button>
                <div id="integration-result" class="result"></div>
            </div>

            <div class="test-section">
                <h3>6. Error Handling Tests</h3>
                <button class="btn-danger" onclick="testErrorHandling()">Test Error Handling</button>
                <button class="btn-warning" onclick="testInvalidInputs()">Test Invalid Inputs</button>
                <button class="btn-info" onclick="testStoreFallback()">Test Store Fallback</button>
                <div id="error-result" class="result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>Live Log Output</h3>
        <button class="btn-primary" onclick="clearLogOutput()">Clear Output</button>
        <button class="btn-success" onclick="exportLogs()">Export Logs</button>
        <div id="log-output" class="log-output"></div>
    </div>

    <script type="module">
        // Mock electronAPI for testing
        window.electronAPI = {
            store: {
                get: async (key) => {
                    // Simulate async store get
                    const value = localStorage.getItem(key);
                    return {
                        success: true,
                        value: value === null ? null : JSON.parse(value)
                    };
                },
                set: async (key, value) => {
                    // Simulate async store set
                    localStorage.setItem(key, JSON.stringify(value));
                    return { success: true };
                }
            }
        };

        // Mock console methods to capture output
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error,
            info: console.info
        };

        const logOutput = [];

        function captureLog(level, ...args) {
            const timestamp = new Date().toISOString();
            const message = args.join(' ');
            logOutput.push({ level, message, timestamp });
            
            // Call original console method
            originalConsole[level](...args);
            
            // Update display
            updateLogDisplay();
        }

        console.log = (...args) => captureLog('log', ...args);
        console.warn = (...args) => captureLog('warn', ...args);
        console.error = (...args) => captureLog('error', ...args);
        console.info = (...args) => captureLog('info', ...args);

        function updateLogDisplay() {
            const outputDiv = document.getElementById('log-output');
            outputDiv.innerHTML = logOutput.map(entry => {
                const levelClass = `log-${entry.level}`;
                return `<div class="log-entry ${levelClass}">[${entry.timestamp}] ${entry.message}</div>`;
            }).join('');
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }

        function clearLogOutput() {
            logOutput.length = 0;
            updateLogDisplay();
        }

        function exportLogs() {
            const logText = logOutput.map(entry => 
                `[${entry.timestamp}] [${entry.level.toUpperCase()}] ${entry.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `debug-log-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Make functions globally available
        window.clearLogOutput = clearLogOutput;
        window.exportLogs = exportLogs;

        // Import and initialize DebugLog module
        let debugLogModule;

        async function initializeDebugLog() {
            try {
                const module = await import('../src/renderer/modules/debug-log/index.js');
                debugLogModule = module.default;
                
                // Reinitialize with mock dependencies
                const reinitialized = debugLogModule.reinitializeDebugLog({
                    electronAPI: window.electronAPI,
                    db: null,
                    store: null
                });
                
                console.log('‚úÖ DebugLog module initialized successfully');
                return reinitialized;
            } catch (error) {
                console.error('‚ùå Failed to initialize DebugLog module:', error);
                return null;
            }
        }

        // Initialize on page load
        window.addEventListener('load', async () => {
            await initializeDebugLog();
        });

        // Test functions
        window.testBasicLogging = async function() {
            const resultDiv = document.getElementById('basic-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                debugLog.log("Basic log message");
                debugLog.info("Info message");
                debugLog.warn("Warning message");
                debugLog.error("Error message");
                await debugLog.debug("Debug message");

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Basic logging tests completed successfully<br>
                        <strong>Messages logged:</strong> 5<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Basic logging test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testLogLevels = async function() {
            const resultDiv = document.getElementById('basic-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test different log levels
                debugLog.setLogLevel(0); // ERROR only
                debugLog.log("This should not appear (ERROR level)");
                debugLog.error("This should appear (ERROR level)");

                debugLog.setLogLevel(2); // INFO level
                debugLog.log("This should appear (INFO level)");
                debugLog.info("This should appear (INFO level)");
                await debugLog.debug("This should not appear (INFO level)");

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Log level tests completed successfully<br>
                        <strong>Expected behavior:</strong> Only appropriate level messages logged<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Log level test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testContextLogging = async function() {
            const resultDiv = document.getElementById('basic-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test context logging
                debugLog.info("User action", { 
                    function: "handleClick", 
                    data: { buttonId: "play", userId: "123" } 
                });

                debugLog.warn("API call failed", { 
                    module: "database", 
                    error: "Connection timeout" 
                });

                await debugLog.debug("Processing data", { 
                    data: { items: 50, processed: 45 },
                    function: "processItems" 
                });

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Context logging tests completed successfully<br>
                        <strong>Context types tested:</strong> Function, Module, Data<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Context logging test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testDebugPreference = async function() {
            const resultDiv = document.getElementById('debug-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test debug preference
                const enabled = await debugLog.isDebugEnabled();
                
                // Test debug messages
                await debugLog.debug("Debug message 1");
                
                // Toggle debug preference
                await debugLog.setDebugEnabled(!enabled);
                await debugLog.debug("Debug message 2");
                
                // Restore original state
                await debugLog.setDebugEnabled(enabled);

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Debug preference tests completed successfully<br>
                        <strong>Initial debug state:</strong> ${enabled}<br>
                        <strong>Toggled state:</strong> ${!enabled}<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Debug preference test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testDebugToggle = async function() {
            const resultDiv = document.getElementById('debug-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Toggle debug on
                await debugLog.setDebugEnabled(true);
                await debugLog.debug("Debug message with debug ON");
                
                // Toggle debug off
                await debugLog.setDebugEnabled(false);
                await debugLog.debug("Debug message with debug OFF");

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Debug toggle tests completed successfully<br>
                        <strong>Expected:</strong> Only first debug message should appear<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Debug toggle test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testDebugCaching = async function() {
            const resultDiv = document.getElementById('debug-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                const startTime = Date.now();
                
                // Multiple calls to test caching
                for (let i = 0; i < 10; i++) {
                    await debugLog.isDebugEnabled();
                }
                
                const endTime = Date.now();
                const duration = endTime - startTime;

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Debug caching test completed successfully<br>
                        <strong>Duration:</strong> ${duration}ms<br>
                        <strong>Calls:</strong> 10<br>
                        <strong>Average:</strong> ${(duration / 10).toFixed(2)}ms per call
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Debug caching test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testContextFormatting = async function() {
            const resultDiv = document.getElementById('context-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test different context formats
                debugLog.info("Simple context", "string context");
                debugLog.info("Object context", { key: "value", number: 42 });
                debugLog.info("Complex context", { 
                    function: "testFunction",
                    module: "testModule",
                    data: { nested: { value: "test" } }
                });

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Context formatting tests completed successfully<br>
                        <strong>Context types tested:</strong> String, Object, Complex<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Context formatting test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testErrorContext = async function() {
            const resultDiv = document.getElementById('context-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test error context
                const testError = new Error("Test error message");
                debugLog.error("Error with context", { 
                    error: testError,
                    function: "testErrorContext",
                    data: { operation: "test" }
                });

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Error context tests completed successfully<br>
                        <strong>Error object:</strong> Test error message<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Error context test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testComplexContext = async function() {
            const resultDiv = document.getElementById('context-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test complex context with multiple properties
                debugLog.info("Complex context test", {
                    function: "testComplexContext",
                    module: "debug-log-test",
                    data: { 
                        items: [1, 2, 3],
                        config: { enabled: true, timeout: 5000 }
                    },
                    userId: "test-user-123",
                    sessionId: "session-abc-456",
                    timestamp: new Date(),
                    custom: "custom property"
                });

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Complex context tests completed successfully<br>
                        <strong>Context properties:</strong> function, module, data, userId, sessionId, timestamp, custom<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Complex context test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testPerformance = async function() {
            const resultDiv = document.getElementById('performance-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                const iterations = 100;
                const startTime = Date.now();

                // Test performance of logging
                for (let i = 0; i < iterations; i++) {
                    debugLog.info(`Performance test message ${i}`);
                }

                const endTime = Date.now();
                const duration = endTime - startTime;
                const avgTime = duration / iterations;

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Performance tests completed successfully<br>
                        <strong>Iterations:</strong> ${iterations}<br>
                        <strong>Total time:</strong> ${duration}ms<br>
                        <strong>Average time:</strong> ${avgTime.toFixed(2)}ms per log
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Performance test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testCaching = async function() {
            const resultDiv = document.getElementById('performance-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test caching by calling isDebugEnabled multiple times
                const startTime = Date.now();
                
                for (let i = 0; i < 50; i++) {
                    await debugLog.isDebugEnabled();
                }
                
                const endTime = Date.now();
                const duration = endTime - startTime;

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Caching tests completed successfully<br>
                        <strong>Calls:</strong> 50<br>
                        <strong>Total time:</strong> ${duration}ms<br>
                        <strong>Average time:</strong> ${(duration / 50).toFixed(2)}ms per call<br>
                        <strong>Caching:</strong> Working (should be fast)
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Caching test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testConditionalLogging = async function() {
            const resultDiv = document.getElementById('performance-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test conditional logging
                const debugEnabled = await debugLog.isDebugEnabled();
                
                // Expensive operation simulation
                const expensiveData = { items: Array.from({ length: 1000 }, (_, i) => i) };
                
                // Only log if debug is enabled
                if (debugEnabled) {
                    await debugLog.debug("Expensive data collected", { data: expensiveData });
                }

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Conditional logging tests completed successfully<br>
                        <strong>Debug enabled:</strong> ${debugEnabled}<br>
                        <strong>Expensive operation:</strong> ${debugEnabled ? 'Logged' : 'Skipped'}<br>
                        <strong>Performance:</strong> Optimized
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Conditional logging test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testModuleLoading = async function() {
            const resultDiv = document.getElementById('integration-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test module properties
                const hasLog = typeof debugLog.log === 'function';
                const hasWarn = typeof debugLog.warn === 'function';
                const hasError = typeof debugLog.error === 'function';
                const hasInfo = typeof debugLog.info === 'function';
                const hasDebug = typeof debugLog.debug === 'function';
                const hasIsDebugEnabled = typeof debugLog.isDebugEnabled === 'function';

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Module loading tests completed successfully<br>
                        <strong>log function:</strong> ${hasLog ? '‚úÖ' : '‚ùå'}<br>
                        <strong>warn function:</strong> ${hasWarn ? '‚úÖ' : '‚ùå'}<br>
                        <strong>error function:</strong> ${hasError ? '‚úÖ' : '‚ùå'}<br>
                        <strong>info function:</strong> ${hasInfo ? '‚úÖ' : '‚ùå'}<br>
                        <strong>debug function:</strong> ${hasDebug ? '‚úÖ' : '‚ùå'}<br>
                        <strong>isDebugEnabled function:</strong> ${hasIsDebugEnabled ? '‚úÖ' : '‚ùå'}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Module loading test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testFunctionExports = async function() {
            const resultDiv = document.getElementById('integration-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test individual function exports
                const { log, warn, error, info, debug, isDebugEnabled } = await import('../src/renderer/modules/debug-log/index.js');

                const hasLogExport = typeof log === 'function';
                const hasWarnExport = typeof warn === 'function';
                const hasErrorExport = typeof error === 'function';
                const hasInfoExport = typeof info === 'function';
                const hasDebugExport = typeof debug === 'function';
                const hasIsDebugEnabledExport = typeof isDebugEnabled === 'function';

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Function export tests completed successfully<br>
                        <strong>log export:</strong> ${hasLogExport ? '‚úÖ' : '‚ùå'}<br>
                        <strong>warn export:</strong> ${hasWarnExport ? '‚úÖ' : '‚ùå'}<br>
                        <strong>error export:</strong> ${hasErrorExport ? '‚úÖ' : '‚ùå'}<br>
                        <strong>info export:</strong> ${hasInfoExport ? '‚úÖ' : '‚ùå'}<br>
                        <strong>debug export:</strong> ${hasDebugExport ? '‚úÖ' : '‚ùå'}<br>
                        <strong>isDebugEnabled export:</strong> ${hasIsDebugEnabledExport ? '‚úÖ' : '‚ùå'}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Function export test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testReinitialization = async function() {
            const resultDiv = document.getElementById('integration-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test reinitialization
                const reinitialized = debugLog.reinitializeDebugLog({
                    electronAPI: window.electronAPI,
                    db: null,
                    store: null
                });

                const hasReinitialize = typeof debugLog.reinitializeDebugLog === 'function';
                const reinitSuccess = reinitialized && typeof reinitialized.log === 'function';

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Reinitialization tests completed successfully<br>
                        <strong>reinitializeDebugLog function:</strong> ${hasReinitialize ? '‚úÖ' : '‚ùå'}<br>
                        <strong>Reinitialization success:</strong> ${reinitSuccess ? '‚úÖ' : '‚ùå'}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Reinitialization test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testErrorHandling = async function() {
            const resultDiv = document.getElementById('error-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test error handling
                debugLog.error("Test error message", { 
                    error: new Error("Test error"),
                    function: "testErrorHandling"
                });

                // Test with invalid log level
                debugLog.setLogLevel(999); // Invalid level
                debugLog.log("This should still work");

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Error handling tests completed successfully<br>
                        <strong>Error logging:</strong> Working<br>
                        <strong>Invalid log level:</strong> Handled gracefully<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Error handling test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testInvalidInputs = async function() {
            const resultDiv = document.getElementById('error-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test invalid inputs
                debugLog.log(null);
                debugLog.log(undefined);
                debugLog.log("");
                debugLog.log(123);
                debugLog.log({});

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Invalid input tests completed successfully<br>
                        <strong>Null input:</strong> Handled<br>
                        <strong>Undefined input:</strong> Handled<br>
                        <strong>Empty string:</strong> Handled<br>
                        <strong>Number input:</strong> Handled<br>
                        <strong>Object input:</strong> Handled<br>
                        <strong>Check the log output above for results</strong>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Invalid input test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        window.testStoreFallback = async function() {
            const resultDiv = document.getElementById('error-result');
            try {
                const debugLog = await initializeDebugLog();
                if (!debugLog) throw new Error('DebugLog module not available');

                // Test store fallback by temporarily removing electronAPI
                const originalElectronAPI = window.electronAPI;
                window.electronAPI = null;

                // This should still work with fallback
                const debugEnabled = await debugLog.isDebugEnabled();

                // Restore electronAPI
                window.electronAPI = originalElectronAPI;

                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Store fallback tests completed successfully<br>
                        <strong>Fallback mechanism:</strong> Working<br>
                        <strong>Debug enabled check:</strong> ${debugEnabled}<br>
                        <strong>Graceful degradation:</strong> ‚úÖ
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Store fallback test failed<br>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        };

        // Initialize test environment
        console.log('üß™ DebugLog Module Test initialized');
        console.log('üìù This test verifies the DebugLog module functionality');
        console.log('üîß Mock electronAPI and console capture are available');
    </script>
</body>
</html> 