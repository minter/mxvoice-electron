<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Holding Tank Double-Click Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .holding-tank {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        .list-group-item {
            padding: 8px;
            margin: 2px 0;
            background: white;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .list-group-item:hover {
            background: #f0f0f0;
        }
        .list-group-item.selected {
            background: #007bff;
            color: white;
        }
        .now_playing {
            background: #28a745 !important;
            color: white !important;
        }
    </style>
</head>
<body>
    <h1>Test Holding Tank Double-Click Fix</h1>
    
    <div class="test-container">
        <h2>Test Functions Availability</h2>
        <button class="test-button" onclick="testFunctionAvailability()">Test Function Availability</button>
        <div id="function-results"></div>
    </div>

    <div class="test-container">
        <h2>Test Holding Tank Mode</h2>
        <button class="test-button" onclick="testHoldingTankMode()">Test Holding Tank Mode</button>
        <button class="test-button" onclick="setStorageMode()">Set Storage Mode</button>
        <button class="test-button" onclick="setPlaylistMode()">Set Playlist Mode</button>
        <div id="mode-results"></div>
    </div>

    <div class="test-container">
        <h2>Test Row Selection</h2>
        <div class="holding-tank">
            <div class="list-group-item" data-song-id="1">Song 1 - Test Song</div>
            <div class="list-group-item" data-song-id="2">Song 2 - Another Test</div>
            <div class="list-group-item" data-song-id="3">Song 3 - Third Test</div>
        </div>
        <button class="test-button" onclick="testRowSelection()">Test Row Selection</button>
        <div id="selection-results"></div>
    </div>

    <div class="test-container">
        <h2>Test Double-Click Functionality</h2>
        <p>Double-click on any song in the holding tank above to test the functionality.</p>
        <div id="double-click-results"></div>
    </div>

    <script>
        // Mock functions for testing
        let mockHoldingTankMode = 'storage';
        let mockAutoplay = false;
        let mockPlaySelectedCalled = false;

        // Mock window functions
        window.toggleSelectedRow = function(row) {
            console.log('‚úÖ toggleSelectedRow called with:', row);
            // Remove previous selection
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('selected');
                item.removeAttribute('id');
            });
            // Select new row
            row.classList.add('selected');
            row.setAttribute('id', 'selected_row');
            return true;
        };

        window.getHoldingTankMode = function() {
            console.log('‚úÖ getHoldingTankMode called, returning:', mockHoldingTankMode);
            return mockHoldingTankMode;
        };

        window.setHoldingTankMode = function(mode) {
            console.log('‚úÖ setHoldingTankMode called with:', mode);
            mockHoldingTankMode = mode;
            return { success: true, mode: mode };
        };

        window.playSelected = function() {
            console.log('‚úÖ playSelected called');
            mockPlaySelectedCalled = true;
            return true;
        };

        // Test function availability
        function testFunctionAvailability() {
            const results = document.getElementById('function-results');
            let success = true;
            let message = '';

            // Test toggleSelectedRow
            if (typeof window.toggleSelectedRow === 'function') {
                message += '‚úÖ toggleSelectedRow is available<br>';
            } else {
                message += '‚ùå toggleSelectedRow is not available<br>';
                success = false;
            }

            // Test getHoldingTankMode
            if (typeof window.getHoldingTankMode === 'function') {
                message += '‚úÖ getHoldingTankMode is available<br>';
            } else {
                message += '‚ùå getHoldingTankMode is not available<br>';
                success = false;
            }

            // Test setHoldingTankMode
            if (typeof window.setHoldingTankMode === 'function') {
                message += '‚úÖ setHoldingTankMode is available<br>';
            } else {
                message += '‚ùå setHoldingTankMode is not available<br>';
                success = false;
            }

            // Test playSelected
            if (typeof window.playSelected === 'function') {
                message += '‚úÖ playSelected is available<br>';
            } else {
                message += '‚ùå playSelected is not available<br>';
                success = false;
            }

            results.innerHTML = `<div class="${success ? 'success' : 'error'}">${message}</div>`;
        }

        // Test holding tank mode
        function testHoldingTankMode() {
            const results = document.getElementById('mode-results');
            const currentMode = window.getHoldingTankMode();
            results.innerHTML = `<div class="info">Current holding tank mode: <strong>${currentMode}</strong></div>`;
        }

        function setStorageMode() {
            const result = window.setHoldingTankMode('storage');
            const results = document.getElementById('mode-results');
            results.innerHTML = `<div class="success">Storage mode set successfully: ${JSON.stringify(result)}</div>`;
        }

        function setPlaylistMode() {
            const result = window.setHoldingTankMode('playlist');
            const results = document.getElementById('mode-results');
            results.innerHTML = `<div class="success">Playlist mode set successfully: ${JSON.stringify(result)}</div>`;
        }

        // Test row selection
        function testRowSelection() {
            const results = document.getElementById('selection-results');
            const testRow = document.querySelector('.list-group-item');
            
            try {
                const result = window.toggleSelectedRow(testRow);
                results.innerHTML = `<div class="success">Row selection test successful: ${result}</div>`;
            } catch (error) {
                results.innerHTML = `<div class="error">Row selection test failed: ${error.message}</div>`;
            }
        }

        // Set up event handlers to simulate the actual functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Single click handler
            document.querySelectorAll('.holding-tank .list-group-item').forEach(item => {
                item.addEventListener('click', function(event) {
                    console.log('üîÑ Single click on holding tank item');
                    window.toggleSelectedRow(this);
                });
            });

            // Double click handler
            document.querySelectorAll('.holding-tank .list-group-item').forEach(item => {
                item.addEventListener('dblclick', function(event) {
                    console.log('üîÑ Double click on holding tank item');
                    const results = document.getElementById('double-click-results');
                    
                    // Remove any existing "now playing" class
                    document.querySelectorAll('.now_playing').forEach(el => {
                        el.classList.remove('now_playing');
                    });

                    // Set the clicked item as selected
                    document.querySelectorAll('#selected_row').forEach(el => {
                        el.removeAttribute('id');
                    });
                    this.setAttribute('id', 'selected_row');

                    // Check holding tank mode
                    if (window.getHoldingTankMode() === "playlist") {
                        // In playlist mode, mark this song as now playing and start autoplay
                        this.classList.add('now_playing');
                        mockAutoplay = true;
                        results.innerHTML = `<div class="success">‚úÖ Playlist mode: Song marked as now playing, autoplay enabled</div>`;
                    } else {
                        results.innerHTML = `<div class="info">‚ÑπÔ∏è Storage mode: Song selected for individual play</div>`;
                    }

                    // Call playSelected
                    window.playSelected();
                });
            });
        });
    </script>
</body>
</html> 