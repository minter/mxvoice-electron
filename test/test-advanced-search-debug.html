<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Search Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background-color: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #28a745;
            color: white;
        }
        .error {
            background-color: #dc3545;
            color: white;
        }
        .info {
            background-color: #17a2b8;
            color: white;
        }
        #console {
            background-color: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .mock-ui {
            background-color: #333;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .mock-search-form {
            border: 1px solid #555;
            padding: 15px;
            border-radius: 4px;
        }
        .mock-advanced-search {
            border: 1px solid #555;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }
        .mock-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
        }
        .debug-info {
            background-color: #444;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Advanced Search Debug Test</h1>
    
    <div class="test-section">
        <h2>Debug Advanced Search Toggle</h2>
        <p>This test helps debug why the advanced search toggle isn't working when it should be hiding.</p>
        
        <button class="test-button" onclick="debugAdvancedSearch()">Debug Advanced Search State</button>
        <button class="test-button" onclick="testToggleFunction()">Test Toggle Function</button>
        <button class="test-button" onclick="simulateToggle()">Simulate Toggle</button>
        
        <div id="results"></div>
    </div>
    
    <div class="test-section">
        <h2>Mock UI Test</h2>
        <div class="mock-ui">
            <div class="mock-search-form">
                <input type="text" id="omni_search" placeholder="Enter search term..." style="width: 200px; padding: 5px;">
                <input type="text" id="title-search" placeholder="Title" style="width: 200px; padding: 5px; display: none;">
                <button class="mock-button" id="advanced_search_button" onclick="simulateToggle()">
                    <i id="advanced-search-icon" class="fas fa-plus">+</i> Advanced
                </button>
                <div id="advanced-search" class="mock-advanced-search">
                    <p>Advanced search options would appear here</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Debug Information</h2>
        <div id="debug-info" class="debug-info"></div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="console"></div>
    </div>

    <script>
        // Mock jQuery for testing with detailed logging
        window.$ = function(selector) {
            return {
                trigger: function(event) {
                    log(`üìù Triggered ${event} on ${selector}`);
                },
                find: function(selector) {
                    return {
                        remove: function() {
                            log(`üìù Removed ${selector} from ${selector}`);
                        }
                    };
                },
                hide: function() {
                    log(`üìù Hiding ${selector}`);
                    if (selector === '#search_results thead') {
                        log(`üìù Hiding search results header`);
                    }
                    // Actually hide the element for testing
                    const element = document.querySelector(selector.replace('#', ''));
                    if (element) {
                        element.style.display = 'none';
                        log(`üìù Actually hid ${selector}`);
                    }
                    return this;
                },
                show: function() {
                    log(`üìù Showing ${selector}`);
                    // Actually show the element for testing
                    const element = document.querySelector(selector.replace('#', ''));
                    if (element) {
                        element.style.display = 'block';
                        log(`üìù Actually showed ${selector}`);
                    }
                    return this;
                },
                focus: function() {
                    log(`üìù Focusing ${selector}`);
                    return this;
                },
                is: function(selector) {
                    if (selector === ':visible') {
                        // Mock visibility check
                        const element = document.querySelector(selector.replace('#', ''));
                        const isVisible = element && element.style.display !== 'none';
                        log(`üìù Checking visibility of ${selector}: ${isVisible}`);
                        return isVisible;
                    }
                    return false;
                },
                css: function(property) {
                    if (property === 'display') {
                        const element = document.querySelector(selector.replace('#', ''));
                        const display = element ? element.style.display : 'none';
                        log(`üìù Getting display of ${selector}: ${display}`);
                        return display;
                    }
                    return '';
                },
                toggleClass: function(classes) {
                    log(`üìù Toggling classes ${classes} on ${selector}`);
                    // Actually toggle the classes for testing
                    const element = document.querySelector(selector.replace('#', ''));
                    if (element) {
                        const classList = classes.split(' ');
                        classList.forEach(className => {
                            element.classList.toggle(className);
                        });
                        log(`üìù Actually toggled classes ${classes} on ${selector}`);
                    }
                    return this;
                },
                length: 1
            };
        };
        
        // Mock animateCSS function
        window.animateCSS = function(element, animation) {
            log(`üìù Animating ${animation} on element`);
            return Promise.resolve('Animation completed');
        };
        
        // Mock scale_scrollable function
        window.scale_scrollable = function() {
            log(`üìù Scaling scrollable elements`);
        };
        
        // Mock searchTimeout
        window.searchTimeout = null;
        
        // Console logging function
        function log(message) {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `[${timestamp}] ${message}\n`;
            console.scrollTop = console.scrollHeight;
        }
        
        // Debug advanced search state
        function debugAdvancedSearch() {
            log('üîç Debugging advanced search state...');
            
            const advancedSearch = document.getElementById('advanced-search');
            const icon = document.getElementById('advanced-search-icon');
            
            if (advancedSearch) {
                log(`üìä Advanced search element found`);
                log(`üìä Display style: ${advancedSearch.style.display}`);
                log(`üìä Computed display: ${window.getComputedStyle(advancedSearch).display}`);
                log(`üìä Is visible: ${advancedSearch.style.display !== 'none'}`);
            } else {
                log(`‚ùå Advanced search element not found`);
            }
            
            if (icon) {
                log(`üìä Icon element found`);
                log(`üìä Icon classes: ${icon.className}`);
                log(`üìä Icon text: ${icon.textContent}`);
            } else {
                log(`‚ùå Icon element not found`);
            }
            
            // Test jQuery visibility check
            const jqueryVisible = $("#advanced-search").is(":visible");
            log(`üìä jQuery visibility check: ${jqueryVisible}`);
            
            updateDebugInfo();
        }
        
        // Test toggle function
        function testToggleFunction() {
            log('üîÑ Testing toggle function...');
            
            if (typeof window.toggleAdvancedSearch === 'function') {
                log('‚úÖ toggleAdvancedSearch function is available');
                try {
                    window.toggleAdvancedSearch();
                    log('‚úÖ toggleAdvancedSearch executed successfully');
                } catch (error) {
                    log(`‚ùå Error in toggleAdvancedSearch: ${error.message}`);
                }
            } else {
                log('‚ùå toggleAdvancedSearch function not available');
            }
        }
        
        // Simulate toggle manually
        function simulateToggle() {
            log('üîÑ Simulating toggle manually...');
            
            const advancedSearch = document.getElementById('advanced-search');
            const icon = document.getElementById('advanced-search-icon');
            const omniSearch = document.getElementById('omni_search');
            const titleSearch = document.getElementById('title-search');
            
            if (advancedSearch.style.display === 'none' || !advancedSearch.style.display) {
                // Show advanced search
                log('üìù Showing advanced search...');
                advancedSearch.style.display = 'block';
                icon.textContent = '-';
                titleSearch.style.display = 'block';
                omniSearch.style.display = 'none';
                log('‚úÖ Advanced search shown');
            } else {
                // Hide advanced search
                log('üìù Hiding advanced search...');
                advancedSearch.style.display = 'none';
                icon.textContent = '+';
                titleSearch.style.display = 'none';
                omniSearch.style.display = 'block';
                log('‚úÖ Advanced search hidden');
            }
            
            updateDebugInfo();
        }
        
        // Update debug information
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            const advancedSearch = document.getElementById('advanced-search');
            const icon = document.getElementById('advanced-search-icon');
            
            let info = '';
            info += `Advanced Search Display: ${advancedSearch ? advancedSearch.style.display : 'N/A'}\n`;
            info += `Icon Text: ${icon ? icon.textContent : 'N/A'}\n`;
            info += `jQuery Visible Check: ${$("#advanced-search").is(":visible")}\n`;
            info += `Toggle Function Available: ${typeof window.toggleAdvancedSearch === 'function'}`;
            
            debugInfo.textContent = info;
        }
        
        function displayResult(type, message) {
            const results = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.textContent = message;
            results.appendChild(resultDiv);
        }
        
        // Initialize test
        log('üöÄ Advanced Search Debug Test initialized');
        log('üìù This test helps debug the advanced search toggle issue');
        updateDebugInfo();
    </script>
</body>
</html> 