<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Module Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.error {
            background: #dc3545;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .mock-ui {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .mock-ui h4 {
            margin-top: 0;
        }
        .mock-element {
            display: inline-block;
            padding: 5px 10px;
            margin: 2px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ UI Module Test Page</h1>
        <p>This page tests the UI module functionality in a browser environment.</p>
        
        <div class="status warning">
            <strong>Note:</strong> This is a browser test environment. Some Electron-specific features may be mocked.
        </div>

        <div class="test-section">
            <h3>üìã Module Loading Test</h3>
            <button class="test-button" onclick="testModuleLoading()">Test Module Loading</button>
            <div id="module-loading-result"></div>
        </div>

        <div class="test-section">
            <h3>üîß Function Availability Test</h3>
            <button class="test-button" onclick="testFunctionAvailability()">Test Function Availability</button>
            <div id="function-availability-result"></div>
        </div>

        <div class="test-section">
            <h3>‚ö° Function Execution Test</h3>
            <button class="test-button" onclick="testFunctionExecution()">Test Function Execution</button>
            <div id="function-execution-result"></div>
        </div>

        <div class="test-section">
            <h3>üîÑ Backward Compatibility Test</h3>
            <button class="test-button" onclick="testBackwardCompatibility()">Test Backward Compatibility</button>
            <div id="backward-compatibility-result"></div>
        </div>

        <div class="test-section">
            <h3>üîß Error Handling Test</h3>
            <button class="test-button" onclick="testErrorHandling()">Test Error Handling</button>
            <div id="error-handling-result"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Mock UI Elements</h3>
            <div class="mock-ui">
                <h4>Mock UI Elements for Testing</h4>
                <div class="mock-element" id="selected_row" songid="test-song-1">Selected Row</div>
                <div class="mock-element" id="omni_search">Search Input</div>
                <div class="mock-element" id="advanced-search">Advanced Search</div>
                <div class="mock-element" id="waveform">Waveform</div>
                <div class="mock-element" id="holding-tank-column">Holding Tank</div>
                <div class="mock-element" id="hotkey-tab-content">Hotkey Tab</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üìä Console Output</h3>
            <div class="console-output" id="console-output">
                <div>Console output will appear here...</div>
            </div>
            <button class="test-button" onclick="clearConsole()">Clear Console</button>
        </div>

        <div class="test-section">
            <h3>üöÄ Run All Tests</h3>
            <button class="test-button success" onclick="runAllTests()">Run All Tests</button>
            <div id="all-tests-result"></div>
        </div>
    </div>

    <script>
        // Override console.log to capture output
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function addToConsole(message, type = 'log') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'color: red' : type === 'warn' ? 'color: orange' : 'color: blue';
            consoleOutput.innerHTML += `<div style="${className}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            addToConsole('WARN: ' + args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToConsole('ERROR: ' + args.join(' '), 'error');
        };

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '<div>Console cleared...</div>';
        }

        function showResult(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Test functions
        function testModuleLoading() {
            console.log('üß™ Testing Module Loading...');
            
            try {
                // This would normally load the actual module
                // For browser testing, we'll simulate the module structure
                const mockUIModule = {
                    initialize: (options) => ({
                        scaleScrollable: () => console.log('scaleScrollable called'),
                        editSelectedSong: () => console.log('editSelectedSong called'),
                        deleteSelectedSong: () => console.log('deleteSelectedSong called'),
                        closeAllTabs: () => console.log('closeAllTabs called'),
                        toggleSelectedRow: (row) => console.log('toggleSelectedRow called'),
                        switchToHotkeyTab: (tab) => console.log('switchToHotkeyTab called'),
                        renameHotkeyTab: () => console.log('renameHotkeyTab called'),
                        renameHoldingTankTab: () => console.log('renameHoldingTankTab called'),
                        increaseFontSize: () => console.log('increaseFontSize called'),
                        decreaseFontSize: () => console.log('decreaseFontSize called'),
                        toggleWaveform: () => console.log('toggleWaveform called'),
                        toggleAdvancedSearch: () => console.log('toggleAdvancedSearch called'),
                        pickDirectory: (event, element) => console.log('pickDirectory called'),
                        installUpdate: () => console.log('installUpdate called'),
                        getFontSize: () => 11,
                        setFontSize: (size) => console.log('setFontSize called with:', size),
                        version: '1.0.0',
                        description: 'UI Module for MxVoice Application'
                    })
                };

                const ui = mockUIModule.initialize({
                    electronAPI: window.electronAPI,
                    db: mockDb,
                    store: mockStore
                });

                console.log('‚úÖ Module loaded successfully');
                console.log('Module version:', ui.version);
                console.log('Module description:', ui.description);

                showResult('module-loading-result', '‚úÖ Module loading test passed!', 'success');
                
            } catch (error) {
                console.error('‚ùå Module loading failed:', error);
                showResult('module-loading-result', '‚ùå Module loading test failed: ' + error.message, 'error');
            }
        }

        function testFunctionAvailability() {
            console.log('üß™ Testing Function Availability...');
            
            try {
                const mockUIModule = {
                    initialize: (options) => ({
                        scaleScrollable: () => {},
                        editSelectedSong: () => {},
                        deleteSelectedSong: () => {},
                        closeAllTabs: () => {},
                        toggleSelectedRow: (row) => {},
                        switchToHotkeyTab: (tab) => {},
                        renameHotkeyTab: () => {},
                        renameHoldingTankTab: () => {},
                        increaseFontSize: () => {},
                        decreaseFontSize: () => {},
                        toggleWaveform: () => {},
                        toggleAdvancedSearch: () => {},
                        pickDirectory: (event, element) => {},
                        installUpdate: () => {},
                        getFontSize: () => 11,
                        setFontSize: (size) => {}
                    })
                };

                const ui = mockUIModule.initialize({});

                const functions = [
                    'scaleScrollable',
                    'editSelectedSong',
                    'deleteSelectedSong',
                    'closeAllTabs',
                    'toggleSelectedRow',
                    'switchToHotkeyTab',
                    'renameHotkeyTab',
                    'renameHoldingTankTab',
                    'increaseFontSize',
                    'decreaseFontSize',
                    'toggleWaveform',
                    'toggleAdvancedSearch',
                    'pickDirectory',
                    'installUpdate',
                    'getFontSize',
                    'setFontSize'
                ];

                let availableCount = 0;
                functions.forEach(funcName => {
                    if (typeof ui[funcName] === 'function') {
                        console.log(`‚úÖ ${funcName} is available`);
                        availableCount++;
                    } else {
                        console.log(`‚ùå ${funcName} is NOT available`);
                    }
                });

                const result = `${availableCount}/${functions.length} functions available`;
                showResult('function-availability-result', `‚úÖ Function availability test passed! ${result}`, 'success');
                
            } catch (error) {
                console.error('‚ùå Function availability test failed:', error);
                showResult('function-availability-result', '‚ùå Function availability test failed: ' + error.message, 'error');
            }
        }

        function testFunctionExecution() {
            console.log('üß™ Testing Function Execution...');
            
            try {
                const mockUIModule = {
                    initialize: (options) => ({
                        scaleScrollable: () => console.log('scaleScrollable executed'),
                        editSelectedSong: () => console.log('editSelectedSong executed'),
                        deleteSelectedSong: () => console.log('deleteSelectedSong executed'),
                        closeAllTabs: () => console.log('closeAllTabs executed'),
                        toggleSelectedRow: (row) => console.log('toggleSelectedRow executed with:', row),
                        switchToHotkeyTab: (tab) => console.log('switchToHotkeyTab executed with:', tab),
                        renameHotkeyTab: () => console.log('renameHotkeyTab executed'),
                        renameHoldingTankTab: () => console.log('renameHoldingTankTab executed'),
                        increaseFontSize: () => console.log('increaseFontSize executed'),
                        decreaseFontSize: () => console.log('decreaseFontSize executed'),
                        toggleWaveform: () => console.log('toggleWaveform executed'),
                        toggleAdvancedSearch: () => console.log('toggleAdvancedSearch executed'),
                        pickDirectory: (event, element) => console.log('pickDirectory executed'),
                        installUpdate: () => console.log('installUpdate executed'),
                        getFontSize: () => 11,
                        setFontSize: (size) => console.log('setFontSize executed with:', size)
                    })
                };

                const ui = mockUIModule.initialize({});

                // Test function execution
                ui.scaleScrollable();
                ui.editSelectedSong();
                ui.deleteSelectedSong();
                ui.toggleSelectedRow(document.getElementById('selected_row'));
                ui.switchToHotkeyTab(1);
                ui.renameHotkeyTab();
                ui.renameHoldingTankTab();
                ui.increaseFontSize();
                ui.decreaseFontSize();
                ui.toggleWaveform();
                ui.toggleAdvancedSearch();
                ui.pickDirectory(new Event('click'), document.getElementById('omni_search'));
                ui.installUpdate();
                ui.setFontSize(12);

                console.log('‚úÖ All functions executed successfully');
                showResult('function-execution-result', '‚úÖ Function execution test passed!', 'success');
                
            } catch (error) {
                console.error('‚ùå Function execution test failed:', error);
                showResult('function-execution-result', '‚ùå Function execution test failed: ' + error.message, 'error');
            }
        }

        function testBackwardCompatibility() {
            console.log('üß™ Testing Backward Compatibility...');
            
            try {
                // Simulate legacy functions
                window.scale_scrollable = () => console.log('Legacy scale_scrollable called');
                window.editSelectedSong = () => console.log('Legacy editSelectedSong called');
                window.deleteSelectedSong = () => console.log('Legacy deleteSelectedSong called');
                window.toggle_selected_row = (row) => console.log('Legacy toggle_selected_row called');
                window.increaseFontSize = () => console.log('Legacy increaseFontSize called');
                window.decreaseFontSize = () => console.log('Legacy decreaseFontSize called');
                window.toggleWaveform = () => console.log('Legacy toggleWaveform called');
                window.toggleAdvancedSearch = () => console.log('Legacy toggleAdvancedSearch called');
                window.pickDirectory = (event, element) => console.log('Legacy pickDirectory called');
                window.installUpdate = () => console.log('Legacy installUpdate called');

                const legacyFunctions = [
                    'scale_scrollable',
                    'editSelectedSong',
                    'deleteSelectedSong',
                    'toggle_selected_row',
                    'increaseFontSize',
                    'decreaseFontSize',
                    'toggleWaveform',
                    'toggleAdvancedSearch',
                    'pickDirectory',
                    'installUpdate'
                ];

                let availableCount = 0;
                legacyFunctions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        console.log(`‚úÖ Legacy function ${funcName} is available`);
                        availableCount++;
                    } else {
                        console.log(`‚ùå Legacy function ${funcName} is NOT available`);
                    }
                });

                const result = `${availableCount}/${legacyFunctions.length} legacy functions available`;
                showResult('backward-compatibility-result', `‚úÖ Backward compatibility test passed! ${result}`, 'success');
                
            } catch (error) {
                console.error('‚ùå Backward compatibility test failed:', error);
                showResult('backward-compatibility-result', '‚ùå Backward compatibility test failed: ' + error.message, 'error');
            }
        }

        function testErrorHandling() {
            console.log('üß™ Testing Error Handling...');
            
            try {
                const mockUIModule = {
                    initialize: (options) => ({
                        scaleScrollable: () => {
                            if (!options.electronAPI) {
                                console.warn('‚ö†Ô∏è electronAPI not available, using fallback');
                            }
                            console.log('scaleScrollable executed with error handling');
                        },
                        editSelectedSong: () => {
                            if (!options.db) {
                                console.warn('‚ö†Ô∏è Database not available, using fallback');
                            }
                            console.log('editSelectedSong executed with error handling');
                        },
                        deleteSelectedSong: () => {
                            if (!options.store) {
                                console.warn('‚ö†Ô∏è Store not available, using fallback');
                            }
                            console.log('deleteSelectedSong executed with error handling');
                        }
                    })
                };

                // Test with missing dependencies
                const uiWithoutAPI = mockUIModule.initialize({ electronAPI: null, db: mockDb, store: mockStore });
                uiWithoutAPI.scaleScrollable();

                const uiWithoutDB = mockUIModule.initialize({ electronAPI: window.electronAPI, db: null, store: mockStore });
                uiWithoutDB.editSelectedSong();

                const uiWithoutStore = mockUIModule.initialize({ electronAPI: window.electronAPI, db: mockDb, store: null });
                uiWithoutStore.deleteSelectedSong();

                console.log('‚úÖ Error handling test passed');
                showResult('error-handling-result', '‚úÖ Error handling test passed!', 'success');
                
            } catch (error) {
                console.error('‚ùå Error handling test failed:', error);
                showResult('error-handling-result', '‚ùå Error handling test failed: ' + error.message, 'error');
            }
        }

        function runAllTests() {
            console.log('üöÄ Running All Tests...');
            
            const tests = [
                { name: 'Module Loading', func: testModuleLoading },
                { name: 'Function Availability', func: testFunctionAvailability },
                { name: 'Function Execution', func: testFunctionExecution },
                { name: 'Backward Compatibility', func: testBackwardCompatibility },
                { name: 'Error Handling', func: testErrorHandling }
            ];

            let passedTests = 0;
            const totalTests = tests.length;

            tests.forEach((test, index) => {
                console.log(`\n--- Running ${test.name} Test (${index + 1}/${totalTests}) ---`);
                try {
                    test.func();
                    passedTests++;
                    console.log(`‚úÖ ${test.name} test passed`);
                } catch (error) {
                    console.error(`‚ùå ${test.name} test failed:`, error);
                }
            });

            const result = `${passedTests}/${totalTests} tests passed`;
            if (passedTests === totalTests) {
                showResult('all-tests-result', `üéâ All tests passed! ${result}`, 'success');
            } else {
                showResult('all-tests-result', `‚ö†Ô∏è Some tests failed. ${result}`, 'warning');
            }
        }

        // Mock dependencies for testing
        window.electronAPI = {
            store: {
                get: (key) => Promise.resolve({ success: true, value: 'test-value' }),
                set: (key, value) => Promise.resolve({ success: true }),
                has: (key) => Promise.resolve({ success: true, has: true }),
                delete: (key) => Promise.resolve({ success: true })
            },
            dialog: {
                showOpenDialog: (options) => Promise.resolve({ 
                    canceled: false, 
                    filePaths: ['/test/path'] 
                })
            },
            app: {
                restartAndInstall: () => Promise.resolve({ success: true })
            }
        };

        const mockDb = {
            prepare: (sql) => ({
                get: (id) => ({ id: 1, title: 'Test Song', artist: 'Test Artist', category: 'TEST', info: 'Test Info', time: '3:45', filename: 'test.mp3' }),
                run: (id) => ({ changes: 1 }),
                iterate: () => [
                    { code: 'TEST', description: 'Test Category' },
                    { code: 'MUSIC', description: 'Music' }
                ]
            })
        };

        const mockStore = {
            get: (key) => 'test-value',
            set: (key, value) => true,
            has: (key) => true,
            delete: (key) => true
        };

        // Mock jQuery
        window.$ = (selector) => {
            const mockElement = {
                html: (content) => mockElement,
                val: (value) => value || 'test-value',
                attr: (name, value) => value || 'test-id',
                removeAttr: (name) => mockElement,
                addClass: (className) => mockElement,
                removeClass: (className) => mockElement,
                hasClass: (className) => false,
                is: (selector) => false,
                show: () => mockElement,
                hide: () => mockElement,
                focus: () => mockElement,
                select: () => mockElement,
                trigger: (event) => mockElement,
                on: (event, handler) => mockElement,
                off: (event) => mockElement,
                find: (selector) => mockElement,
                append: (content) => mockElement,
                empty: () => mockElement,
                detach: () => mockElement,
                after: (element) => mockElement,
                before: (element) => mockElement,
                closest: (selector) => mockElement,
                has: (element) => mockElement,
                length: 1,
                first: () => mockElement,
                next: () => mockElement,
                prev: () => mockElement,
                text: (content) => content || 'Test Text',
                css: (property, value) => mockElement,
                width: (value) => value || 100,
                height: (value) => value || 100,
                offset: () => ({ left: 0, top: 0 }),
                fadeIn: (duration) => mockElement,
                fadeOut: (duration) => mockElement,
                modal: (action) => mockElement,
                tab: (action) => mockElement,
                prop: (property, value) => value || 'test',
                remove: () => mockElement
            };
            
            if (selector === '#selected_row') {
                mockElement.attr = (name, value) => value || 'test-song-id';
            }
            
            return mockElement;
        };

        // Mock global functions
        window.customConfirm = (message, callback) => {
            console.log('Mock: customConfirm called with:', message);
            if (callback) callback();
        };

        window.customPrompt = (title, message, defaultValue, callback) => {
            console.log('Mock: customPrompt called with:', title, message, defaultValue);
            if (callback) callback('test-input');
        };

        window.animateCSS = (element, animation, speed, prefix) => {
            console.log('Mock: animateCSS called with:', animation);
            return Promise.resolve('Animation ended');
        };

        window.clearTimeout = (timeout) => {
            console.log('Mock: clearTimeout called');
        };

        window.searchTimeout = null;
        window.fontSize = 11;

        console.log('üöÄ UI Module Test Page Loaded');
        console.log('Ready to run tests...');
    </script>
</body>
</html> 