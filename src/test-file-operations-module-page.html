<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Operations Module Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>File Operations Module Test</h1>
    
    <div class="test-section">
        <h2>Module Loading Test</h2>
        <button class="test-button" onclick="testModuleLoading()">Test Module Loading</button>
        <div id="module-loading-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>Core File Operations Test</h2>
        <button class="test-button" onclick="testOpenHotkeyFile()">Test openHotkeyFile()</button>
        <button class="test-button" onclick="testOpenHoldingTankFile()">Test openHoldingTankFile()</button>
        <button class="test-button" onclick="testSaveHotkeyFile()">Test saveHotkeyFile()</button>
        <button class="test-button" onclick="testSaveHoldingTankFile()">Test saveHoldingTankFile()</button>
        <div id="file-operations-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>System Operations Test</h2>
        <button class="test-button" onclick="testPickDirectory()">Test pickDirectory()</button>
        <button class="test-button" onclick="testInstallUpdate()">Test installUpdate()</button>
        <div id="system-operations-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>Integration Test</h2>
        <button class="test-button" onclick="testIntegration()">Test Full Integration</button>
        <div id="integration-log" class="log"></div>
    </div>

    <script type="module">
        // Mock dependencies for testing
        window.electronAPI = {
            openHotkeyFile: () => Promise.resolve('hotkey-file-opened'),
            openHoldingTankFile: () => Promise.resolve('holding-tank-file-opened'),
            saveHotkeyFile: (data) => Promise.resolve('hotkey-file-saved'),
            saveHoldingTankFile: (data) => Promise.resolve('holding-tank-file-saved'),
            restartAndInstall: () => Promise.resolve('update-installed')
        };

        window.ipcRenderer = {
            send: (channel, data) => console.log(`IPC Send: ${channel}`, data),
            invoke: (channel, data) => Promise.resolve(`IPC Invoke: ${channel} ${data}`)
        };

        // Mock jQuery
        window.$ = (selector) => ({
            val: (value) => value || 'mocked-value',
            attr: (attr) => 'mocked-song-id',
            each: (callback) => callback.call({ attr: () => 'mocked-song-id' }),
            text: () => 'mocked-text'
        });

        // Mock global variables
        window.defaultPath = '/mocked/path';

        // Import the module
        let fileOperationsModule;

        async function loadModule() {
            try {
                fileOperationsModule = await import('./renderer/modules/file-operations/index.js');
                log('Module loaded successfully', 'success', 'module-loading-log');
                return true;
            } catch (error) {
                log(`Failed to load module: ${error.message}`, 'error', 'module-loading-log');
                return false;
            }
        }

        function log(message, type = 'info', logId = 'file-operations-log') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById(logId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            logElement.innerHTML += `[${timestamp}] <span class="${className}">${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Test functions
        window.testModuleLoading = async function() {
            log('Testing module loading...', 'info', 'module-loading-log');
            const success = await loadModule();
            if (success) {
                log('✅ All module functions are available', 'success', 'module-loading-log');
                log(`Available functions: ${Object.keys(fileOperationsModule).join(', ')}`, 'info', 'module-loading-log');
            }
        };

        window.testOpenHotkeyFile = function() {
            log('Testing openHotkeyFile()...', 'info');
            try {
                fileOperationsModule.openHotkeyFile();
                log('✅ openHotkeyFile() called successfully', 'success');
            } catch (error) {
                log(`❌ openHotkeyFile() failed: ${error.message}`, 'error');
            }
        };

        window.testOpenHoldingTankFile = function() {
            log('Testing openHoldingTankFile()...', 'info');
            try {
                fileOperationsModule.openHoldingTankFile();
                log('✅ openHoldingTankFile() called successfully', 'success');
            } catch (error) {
                log(`❌ openHoldingTankFile() failed: ${error.message}`, 'error');
            }
        };

        window.testSaveHotkeyFile = function() {
            log('Testing saveHotkeyFile()...', 'info');
            try {
                fileOperationsModule.saveHotkeyFile();
                log('✅ saveHotkeyFile() called successfully', 'success');
            } catch (error) {
                log(`❌ saveHotkeyFile() failed: ${error.message}`, 'error');
            }
        };

        window.testSaveHoldingTankFile = function() {
            log('Testing saveHoldingTankFile()...', 'info');
            try {
                fileOperationsModule.saveHoldingTankFile();
                log('✅ saveHoldingTankFile() called successfully', 'success');
            } catch (error) {
                log(`❌ saveHoldingTankFile() failed: ${error.message}`, 'error');
            }
        };

        window.testPickDirectory = function() {
            log('Testing pickDirectory()...', 'info', 'system-operations-log');
            try {
                const mockEvent = { preventDefault: () => {} };
                const mockElement = { value: '/test/path' };
                fileOperationsModule.pickDirectory(mockEvent, mockElement);
                log('✅ pickDirectory() called successfully', 'success', 'system-operations-log');
            } catch (error) {
                log(`❌ pickDirectory() failed: ${error.message}`, 'error', 'system-operations-log');
            }
        };

        window.testInstallUpdate = function() {
            log('Testing installUpdate()...', 'info', 'system-operations-log');
            try {
                fileOperationsModule.installUpdate();
                log('✅ installUpdate() called successfully', 'success', 'system-operations-log');
            } catch (error) {
                log(`❌ installUpdate() failed: ${error.message}`, 'error', 'system-operations-log');
            }
        };

        window.testIntegration = async function() {
            log('Testing full integration...', 'info', 'integration-log');
            
            try {
                // Test all functions
                fileOperationsModule.openHotkeyFile();
                fileOperationsModule.openHoldingTankFile();
                fileOperationsModule.saveHotkeyFile();
                fileOperationsModule.saveHoldingTankFile();
                
                const mockEvent = { preventDefault: () => {} };
                const mockElement = { value: '/test/path' };
                fileOperationsModule.pickDirectory(mockEvent, mockElement);
                fileOperationsModule.installUpdate();
                
                log('✅ All file operations functions executed successfully', 'success', 'integration-log');
                log('✅ Module integration test passed', 'success', 'integration-log');
            } catch (error) {
                log(`❌ Integration test failed: ${error.message}`, 'error', 'integration-log');
            }
        };

        // Auto-load module on page load
        window.addEventListener('load', () => {
            loadModule();
        });
    </script>
</body>
</html> 